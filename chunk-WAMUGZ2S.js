import{d as u}from"./chunk-BUERT3MI.js";import{Db as c,O as o,S as s,d as i,ga as n}from"./chunk-JIKRBGP3.js";var h=class a{constructor(t,e){this.router=t;this.supabase=e;this.initAuth()}_authenticated=n(!1);_initialized=n(!1);authenticated=this._authenticated.asReadonly();initialized=this._initialized.asReadonly();initAuth(){return i(this,null,function*(){try{let t=yield this.supabase.getSession();this._authenticated.set(!!t),this.supabase.onAuthStateChange((e,r)=>{this._authenticated.set(!!r),e==="PASSWORD_RECOVERY"&&this.router.navigate(["/admin/reset-password"])})}catch(t){console.error("Auth init error",t)}finally{this._initialized.set(!0)}})}ensureAuth(){return i(this,null,function*(){return this.initialized()?this.authenticated():new Promise(t=>{let e=setInterval(()=>{this.initialized()&&(clearInterval(e),t(this.authenticated()))},50)})})}login(t,e){return i(this,null,function*(){try{return yield this.supabase.signIn(t,e),this._authenticated.set(!0),!0}catch(r){return console.error("Login error:",r),!1}})}logout(){return i(this,null,function*(){try{yield this.supabase.signOut(),this._authenticated.set(!1),this.router.navigate(["/"])}catch(t){console.error("Logout error:",t)}})}static \u0275fac=function(e){return new(e||a)(s(u),s(c))};static \u0275prov=o({token:a,factory:a.\u0275fac,providedIn:"root"})};export{h as a};
